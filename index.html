<!DOCTYPE html>
<html lang="he">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>AnaelV1 - המשחק של ענהאל</title>
  <link rel="stylesheet" href="css/all.min.css">
   <link rel="manifest" href="manifest.json">
    <meta name="theme-color" content="#00ffe7">



  <style>
body {
  margin: 0;
  font-family: Arial, sans-serif;
  background-color: #050d1d;
  color: #00ffe7;
  direction: rtl;
  overflow: hidden;
}

body.animated-bg {
  background: linear-gradient(270deg, #0f0f1f, #1a0033, #002244);
  background-size: 600% 600%;
}

/* רקעים דינאמיים */
/* בסיס כללי לכל האפקטים */
.bg-effect-layer {
  position: fixed;
  inset: 0;
  pointer-events: none;
  z-index: 0;
  overflow: hidden;
}

/* אפקט: בועות זוהרות */
@keyframes floatBubbles {
  0% { transform: translateY(0) scale(0.8); opacity: 1; }
  100% { transform: translateY(-120vh) scale(1.2); opacity: 0; }
}

/* אפקט: כוכבים מהבהבים ונעים */
@keyframes starsTwinkle {
  0%, 100% { opacity: 0.6; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.2); }
}

/* אפקט: שובל אור רך */
@keyframes lightTrail {
  0% { transform: translateX(-100%) rotate(0deg); opacity: 0; }
  50% { opacity: 0.7; }
  100% { transform: translateX(100%) rotate(360deg); opacity: 0; }
}

/* אפקט: זיקוקים עדינים */
@keyframes softFirework {
  0% { transform: scale(0.2); opacity: 0; }
  50% { transform: scale(1); opacity: 1; }
  100% { transform: scale(1.5); opacity: 0; }
}

/* אפקט: נקודות צבע משתנות */
@keyframes colorDotsPulse {
  0%, 100% { opacity: 0.6; transform: scale(1); }
  50% { opacity: 1; transform: scale(1.3); }
}
@keyframes floatFlames {
  0% { transform: translateY(0) scale(1); opacity: 0.8; }
  50% { transform: translateY(-50vh) scale(1.5); opacity: 1; }
  100% { transform: translateY(0) scale(1); opacity: 0.8; }
}

@keyframes rainFall {
  0% { transform: translateY(0); opacity: 0.3; }
  100% { transform: translateY(100vh); opacity: 0; }
}

@keyframes laserSweep {
  0% { transform: translateX(0); opacity: 0.2; }
  50% { transform: translateX(100vw); opacity: 1; }
  100% { transform: translateX(0); opacity: 0.2; }
}
/* 2. Rotating Aura */
@keyframes rotatingAura {
  0% { transform: rotate(0deg) scale(1); opacity: 0.2; }
  50% { transform: rotate(180deg) scale(1.2); opacity: 0.4; }
  100% { transform: rotate(360deg) scale(1); opacity: 0.2; }
}

/* 3. Hex Grid Pulse */
@keyframes hexPulse {
  0%, 100% { transform: scale(1); opacity: 0.3; }
  50% { transform: scale(1.2); opacity: 0.6; }
}

/* 4. Twist Swirl */
@keyframes twistSwirl {
  0% { transform: translate(0, 0) rotate(0deg); opacity: 0.2; }
  100% { transform: translate(50vw, 50vh) rotate(360deg); opacity: 0; }
}

/* 6. Galaxy Spiral */
@keyframes galaxySpiral {
  0% { transform: rotate(0deg) translateX(0px); opacity: 1; }
  100% { transform: rotate(360deg) translateX(100px); opacity: 0; }
}






.top-bar {
  position: fixed;
  top: 0;
  right: 0;
  left: 0;
  height: auto;
  background: rgba(0, 0, 0, 0.7);
  display: flex;
  flex-wrap: wrap;
  justify-content: center;
  align-items: center;
  gap: 10px;
  padding: 10px;
  z-index: 100;
  border-bottom: 2px solid #00ffe7;
}
.top-bar button,
.emoji-box-toggle,
.card-box-toggle {
  background: transparent;
  border: 2px solid #00ffe7;
  color: #00ffe7;
  font-size: 1.1em;
  padding: 6px 12px;
  border-radius: 10px;
  box-shadow: 0 0 8px #00ffe7;
  transition: all 0.3s ease;
  cursor: pointer;
  display: flex;
  align-items: center;
  gap: 5px;
}
.top-bar button:hover,
.emoji-box-toggle:hover,
.card-box-toggle:hover {
  background-color: #00ffe7;
  color: #000;
  transform: scale(1.05);
}
.coin-display {
  font-size: 1.1em;
  color: #FFD700;
  display: flex;
  align-items: center;
  gap: 5px;
}
.main-frame-wrapper {
  position: fixed;
  top: 100px;
  bottom: 0;
  left: 0;
  right: 0;
  display: flex;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 10px;
  box-sizing: border-box;
  overflow-y: auto;
  z-index: 10;
}
.main-frame {
  width: 100%;
  max-width: 420px;
  background: rgba(0, 0, 0, 0.5);
  border: 2px solid #00ffe7;
  box-shadow: 0 0 10px #00ffe7;
  border-radius: 20px;
  padding: 20px;
  display: flex;
  flex-direction: column;
  gap: 20px;
  box-sizing: border-box;
}
.hud-container {
  display: flex;
  align-items: center;
  justify-content: space-between;
  gap: 10px;
}
.hud-box {
  font-size: 1.2em;
  flex: 1;
  text-align: center;
}
#progress-bar {
  flex: 2;
  height: 35px;
  background: #222;
  border-radius: 10px;
  overflow: hidden;
  box-shadow: 0 0 5px #00ffe7 inset;
}
#progress-inner {
  height: 100%;
  width: 30%;
  background: linear-gradient(to right, #00ffe7, #9f3cfa);
  border-radius: 10px;
  transition: width 0.3s ease;
}
#emoji-preview {
  text-align: center;
  font-size: 2.5em;
  margin-top: -10px;
  margin-bottom: -10px;
}
.question-box {
  font-size: 2em;
  text-align: center;
  padding: 15px;
  border: 2px solid #00ffe7;
  border-radius: 12px;
  background: rgba(0, 255, 231, 0.05);
  box-shadow: 0 0 15px #00ffe7 inset;
  word-break: break-word;
}
input[type="text"] {
  background: rgba(0, 0, 0, 0.3);
  color: #00ffe7;
  border: 2px solid #00ffe7;
  box-shadow: 0 0 10px #00ffe7;
  text-align: center;
  font-size: 1.3em;
  border-radius: 10px;
  padding: 12px;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
}
input[type="text"]:focus {
  border-color: #9f3cfa;
  box-shadow: 0 0 15px #9f3cfa;
  outline: none;
}
#submit-btn,
#reveal-btn {
  background: rgba(0, 0, 0, 0.2);
  border: 2px solid #00ffe7;
  color: #00ffe7;
  text-shadow: 0 0 6px #00ffe7;
  box-shadow: 0 0 10px #00ffe7;
  transition: all 0.3s ease;
  font-size: 1.3em;
  padding: 10px;
  border-radius: 10px;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  cursor: pointer;
}
#submit-btn:hover,
#reveal-btn:hover {
  background-color: #00ffe7;
  color: #000;
  transform: scale(1.03);
}
#reveal-btn {
  position: fixed;
  bottom: 15px;
  left: 10px;
  right: 10px;
  width: calc(100% - 20px);
  max-width: 420px;
  margin: auto;
  z-index: 200;
}
.options {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
  gap: 10px;
  width: 100%;
  box-sizing: border-box;
}
.options button {
  font-size: 1.3em;
  padding: 10px;
  border-radius: 12px;
  border: 2px solid #00ffe7;
  background: transparent;
  color: #00ffe7;
  width: 100%;
  max-width: 100%;
  box-sizing: border-box;
  box-shadow: 0 0 8px #00ffe7;
  transition: 0.3s;
}
.options button:hover {
  background: #00ffe7;
  color: #000;
  transform: scale(1.03);
}
.feedback {
  text-align: center;
  font-size: 1.4em;
  min-height: 1.5em;
}
@media (max-width: 600px) {
  .main-frame {
    max-width: 95vw;
    padding: 15px;
  }
  input, button {
    font-size: 1.2em;
  }
  #reveal-btn {
    font-size: 1.1em;
    bottom: 10px;
    left: 10px;
    right: 10px;
  }
}

#slot-popup {
  display: none;
  position: fixed;
  inset: 0;
  background: radial-gradient(ellipse at center, #0f0f1f 0%, #000 100%);
  z-index: 9999;
  flex-direction: column;
  align-items: center;
  justify-content: center;
  padding: 30px;
  border: 4px solid #00ffe7;
  box-shadow: 0 0 40px #00ffe7;
  border-radius: 20px;
  animation: popup-glow 0.5s ease-out;
}

@keyframes popup-glow {
  from {
    opacity: 0;
    transform: scale(0.9);
    box-shadow: 0 0 0 #00ffe7;
  }
  to {
    opacity: 1;
    transform: scale(1);
    box-shadow: 0 0 40px #00ffe7;
  }
}

.slot-machine {
  display: flex;
  gap: 20px;
  margin-bottom: 20px;
  padding: 30px;
  background: radial-gradient(circle at center, #1a1a1a, #000000);
  border: 8px solid #d4af37;
  border-radius: 20px;
  box-shadow:
    0 0 25px #ffd700,
    0 0 45px #ffcc00 inset,
    inset 0 0 10px #fff8dc,
    0 0 10px rgba(255, 215, 0, 0.6);
  position: relative;
  overflow: hidden;
}

.slot-machine::before {
  content: "";
  position: absolute;
  top: -50%;
  left: -50%;
  width: 200%;
  height: 200%;
  background: linear-gradient(
    120deg,
    transparent 0%,
    rgba(255, 255, 255, 0.15) 50%,
    transparent 100%
  );
  transform: rotate(25deg);
  animation: sheen 3s infinite linear;
  pointer-events: none;
}
@keyframes sheen {
  0% { transform: rotate(25deg) translateX(-100%); }
  100% { transform: rotate(25deg) translateX(100%); }
}




.reel {
  width: 80px;
  height: 80px;
  background: #111;
  border: 4px solid #00ffe7;
  border-radius: 12px;
  font-size: 3em;
  display: flex;
  align-items: center;
  justify-content: center;
  box-shadow: 0 0 20px #00ffe7 inset;
  animation: pulse 1.5s infinite alternate;
}

@keyframes pulse {
  from { transform: scale(1); }
  to { transform: scale(1.05); }
}

#slot-message {
  font-size: 1.5em;
  color: #00ffe7;
  margin-top: 15px;
  padding: 10px 20px;
  border: 2px solid #00ffe7;
  border-radius: 10px;
  background: rgba(0, 255, 231, 0.05);
  box-shadow: 0 0 10px #00ffe7;
}

#slot-spin-btn {
  margin-top: 20px;
  padding: 12px 24px;
  font-size: 1.2em;
  background: #00ffe7;
  color: #000;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 0 10px #00ffe7;
  transition: 0.3s;
}

#slot-spin-btn:hover {
  background: #00ccff;
}

.spinning span {
  animation: spin 0.3s linear infinite;
}

@keyframes spin {
  0% { transform: translateY(-100%); opacity: 0.2; }
  50% { transform: translateY(50%); opacity: 0.8; }
  100% { transform: translateY(0); opacity: 1; }
}

.message {
  font-size: 1.5em;
  margin-top: 20px;
  transition: opacity 0.3s ease;
  color: #00ffe7;
  text-align: center;
}

.message:empty {
  display: none;
}


#spinBtn {
  margin-top: 20px;
  padding: 12px 24px;
  font-size: 1.2em;
  background: #00ffe7;
  color: #000;
  border: none;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 0 10px #00ffe7;
  transition: 0.3s;
}
#spinBtn:hover {
  background: #00ccff;
}


@media (max-width: 480px) {
  #slot-popup {
    padding: 20px;
    border-width: 2px;
    border-radius: 12px;
  }

  .reel {
    width: 60px;
    height: 60px;
    font-size: 2.5em;
  }

  #slot-spin-btn {
    padding: 10px 20px;
    font-size: 1em;
  }

  #slot-message {
    font-size: 1.2em;
    padding: 8px 16px;
  }
}

#animated-background {
  position: fixed;
  top: 0; left: 0;
  width: 100vw;
  height: 100vh;
  z-index: -1;
  background: #050d1d;
  transition: all 1s ease-in-out;
}


/* רטט קל + ניאון */
#progress-bar.increase {
  animation: pulseGlow 0.6s ease-in-out;
  box-shadow: 0 0 15px #00ffe7, 0 0 25px #9f3cfa;
}

@keyframes pulseGlow {
  0% { transform: scaleX(1); }
  50% { transform: scaleX(1.05); }
  100% { transform: scaleX(1); }
}

/* חלקיק אנרגיה עולה */
.energy-particle {
  position: absolute;
  bottom: 0;
  font-size: 1.2em;
  animation: flyUp 1.2s ease-out forwards;
  pointer-events: none;
  opacity: 0.8;
}

@keyframes flyUp {
  0% {
    transform: translateY(0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translateY(-40px) scale(1.4);
    opacity: 0;
  }
}

/* פיצוץ אנרגיה */
#progress-bar.burst {
  animation: shakeBar 0.6s ease-in-out;
  box-shadow: 0 0 25px gold, 0 0 40px white;
}

@keyframes shakeBar {
  0% { transform: translateX(0); }
  25% { transform: translateX(-2px); }
  50% { transform: translateX(2px); }
  75% { transform: translateX(-2px); }
  100% { transform: translateX(0); }
}

/* ניצוצות שמתפזרים */
.spark {
  position: absolute;
  font-size: 1.2em;
  animation: sparkExplode 1.8s ease-out forwards;
  pointer-events: none;
  opacity: 0.8;
}

@keyframes sparkExplode {
  0% {
    transform: translate(0, 0) scale(1);
    opacity: 1;
  }
  100% {
    transform: translate(calc(-50px + 100px * var(--dx)), calc(-50px + 100px * var(--dy))) scale(1.2);
    opacity: 0;
  }
}

.word-editor-toggle {
  background: transparent;
  border: 2px solid #00ffe7;
  color: #00ffe7;
  font-size: 1em;
  padding: 5px 15px;
  cursor: pointer;
  border-radius: 8px;
  margin-left: 10px;
}

.word-editor-wrapper {
  position: absolute;
  top: 60px;
  right: 0;
  left: 0;
  display: none;
  flex-direction: column;
  align-items: center;
  gap: 10px;
  z-index: 999;
  padding: 15px;
  background: rgba(0, 0, 0, 0.75);
  border: 2px solid #00ffe7;
  border-radius: 10px;
  max-height: 80vh;
  overflow-y: auto;
}

.word-editor-wrapper input {
  padding: 8px;
  font-size: 1em;
  border: 1px solid #00ffe7;
  border-radius: 6px;
  width: 80%;
  background: black;
  color: #00ffe7;
  text-align: center;
}

.word-list-entry {
  display: flex;
  justify-content: space-between;
  background: #111;
  padding: 8px;
  width: 90%;
  color: #00ffe7;
  border-bottom: 1px solid #00ffe7;
}

.word-list-entry button {
  background: red;
  color: white;
  border: none;
  border-radius: 5px;
  padding: 2px 8px;
  cursor: pointer;
}

.word-editor-wrapper .add-word-button {
  background: #00ffe7;
  color: black;
  font-weight: bold;
  padding: 6px 12px;
  border: none;
  border-radius: 8px;
  margin-bottom: 10px;
  cursor: pointer;
}






  </style>
</head>
<body>
  <div id="animated-background"></div>
  <audio id="yes1" src="sounds/yes.ogg" preload="auto"></audio>
  <audio id="no1" src="sounds/no.ogg" preload="auto"></audio>
  <audio id="slot1" src="sounds/slot.ogg" preload="auto"></audio>
  <audio id="slot2" src="sounds/slot2.ogg" preload="auto"></audio>
  <audio id="card1" src="sounds/CARD.ogg" preload="auto"></audio>




  
  <div class="top-bar">
    <button class="word-editor-toggle" onclick="toggleWordEditor()" style="display: none;">עריכת מילים</button>

    <button id="reveal-btn1" style="color: yellow;">הצג תשובה נכונה</button>
    <button onclick="startEnglishMode()">אנגלית</button>
    <button onclick="startMathMode()">חשבון</button>
    <div class="emoji-box-toggle" onclick="openEmojiModal()">😁 אימוג'ים</div>

    <div class="card-box-toggle" onclick="openCardModal()">🃏 קלפים</div>


    <div class="coin-display"><i class="fas fa-coins"></i> <span id="coin-count">0</span></div>
  </div>
  <div class="main-frame-wrapper">
    <div class="main-frame">
      <div class="hud-container">
        <div class="hud-box">ניקוד: <strong id="score">0</strong></div>
        <div id="progress-bar"><div id="progress-inner"><p style="white-space: nowrap; color: yellow; font-size: 1.1em; font-weight: bold; text-shadow: 0 0 6px yellow; margin: 0px; padding: 5px;">
          המשחק של ענהאל
        </p></div></div>
        <div class="hud-box">שלב: <strong id="level">1</strong></div>
      </div>
      <div id="emoji-preview"></div>
      <div class="question-box" id="question">ברוך הבא!</div>
      <input type="text" id="answer" class="hidden" placeholder="הקלד כאן">
      <button id="submit-btn" class="hidden">שלח תשובה</button>
      <div class="options hidden" id="options"></div>
      <div class="feedback" id="feedback"></div>
    </div>
  </div>

  <button id="installBtn" style="
  position: fixed;
  bottom: 20px;
  left: 50%;
  transform: translateX(-50%);
  background: #00ffe7;
  color: #000;
  border: none;
  padding: 12px 24px;
  font-size: 1.2em;
  border-radius: 12px;
  box-shadow: 0 0 10px #00ffe7;
  cursor: pointer;
  z-index: 9999;
  display: none;
">
📲 התקן את Anael1
</button>


  <div id="emoji-modal" style="
  display: none;
  position: fixed;
  top: 60px;
  bottom: 20px;
  left: 10px;
  right: 10px;
  max-width: 420px;
  margin: auto;
  background: rgba(0,0,0,0.9);
  border: 2px solid #00ffe7;
  border-radius: 12px;
  box-shadow: 0 0 20px #00ffe7;
  color: #00ffe7;
  z-index: 300;
  overflow-y: auto;
  padding: 20px;
  font-size: 2em;
">
  <div style="text-align: left;">
    <button onclick="closeEmojiModal()" style="
      background: none;
      border: none;
      color: #00ffe7;
      font-size: 1em;
      cursor: pointer;
      position: absolute;
      top: 10px;
      left: 15px;
    ">
      ✖
    </button>
  </div>
  <div id="emoji-modal-content" style="margin-top: 30px;"></div>
</div>




<div id="card-modal" style="
  display: none;
  position: fixed;
  top: 60px;
  bottom: 20px;
  left: 10px;
  right: 10px;
  max-width: 420px;
  margin: auto;
  background: rgba(0,0,0,0.9);
  border: 2px solid #00ffe7;
  border-radius: 12px;
  box-shadow: 0 0 20px #00ffe7;
  color: #00ffe7;
  z-index: 300;
  overflow-y: auto;
  padding: 20px;
  font-size: 1.8em;
">
  <div style="text-align: left;">
    <button onclick="closeCardModal()" style="
      background: none;
      border: none;
      color: #00ffe7;
      font-size: 1em;
      cursor: pointer;
      position: absolute;
      top: 10px;
      left: 15px;
    ">
      ✖
    </button>
  </div>
  <div id="card-modal-content" style="margin-top: 30px;"></div>
</div>


<div id="slot-popup">
  <div class="slot-machine">
    <div class="reel" id="reel1"><span>⭐</span></div>
    <div class="reel" id="reel2"><span>⭐</span></div>
    <div class="reel" id="reel3"><span>⭐</span></div>
  </div>
  <button onclick="startSpin()" id="spinBtn">סובב</button>
  <div class="message" id="slot-message"></div>  
</div>

<div class="word-editor-wrapper" id="wordEditor" style="display: none;">
  <button class="add-word-button" onclick="addNewWord()">➕ הוסף מילה</button>

  <input type="text" id="newWordInput" placeholder="מילה באנגלית">
  <input type="text" id="newTranslationInput" placeholder="תרגום לעברית">

  <div id="wordList"></div>
</div>







  


  <script>
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () => {
    navigator.serviceWorker.register('/service-worker.js')
      .then(reg => console.log('Service worker registered:', reg.scope))
      .catch(err => console.error('Service worker error:', err));
  });
}

    class GameState {
      constructor() {
        this.emojiBox = [];
        this.score = 0;
        this.level = 1;
        this.coins = 0;
        this.cards = [];
        this.cardColors = {};
        this.emojiIndex = 0;
        this.load();
        
      }

      load() {
        const saved = JSON.parse(localStorage.getItem("gameState") || "{}"); // ⬅️ צריך להיות ראשון
        this.emojiBox = saved.emojiBox || [];
        this.score = saved.score || 0;
        this.level = saved.level || 1;
        this.coins = saved.coins || 0;
        this.cards = saved.cards || [];
        this.cardColors = saved.cardColors || {}; // ⬅️ חשוב
        this.emojiIndex = saved.emojiIndex || 0;

      }


      save() {
        localStorage.setItem("gameState", JSON.stringify({
          emojiBox: this.emojiBox,
          score: this.score,
          level: this.level,
          coins: this.coins,
          cards: this.cards,
          cardColors: this.cardColors, // ⬅️ כאן היה חסר פסיק בשורה שלפני
          emojiIndex: this.emojiIndex, // שורה חדשה

        }));
      }


      addEmoji(emoji) {
        this.emojiBox.push(emoji);
        this.save();
      }

      incrementScore(points = 1) {
        this.score += points;
        const newLevel = Math.floor(this.score / 10) + 1;
        if (newLevel !== this.level) {
          this.level = newLevel;
        }
        this.save();
      }

      addCoins(n = 1) {
        this.coins += n;
        this.save();
      }

      spendCoins(n) {
        if (this.coins >= n) {
          this.coins -= n;
          this.save();
          return true;
        }
        return false;
      }

      addCard(icon) {
      if (!this.cards.includes(icon)) {
        this.cards.push(icon);
        if (!this.cardColors) this.cardColors = {};
        const index = this.cards.length - 1;
        this.cardColors[icon] = cardColors[index % cardColors.length];
        this.save();
      }
    }


      hasCard(icon) {
        return this.cards.includes(icon);
      }
    }


    // שאלות
    let emojis = [
  "😀", "😃", "😄", "😁", "😆", "😅", "😂", "🤣", "😊", "😇",
  "🙂", "🙃", "😉", "😌", "😍", "🥰", "😘", "😗", "😙", "😚",
  "😋", "😛", "😝", "😜", "🤪", "🤨", "🧐", "🤓", "😎",
  "🤩", "🥳", "😏", "😒", "😞", "😔", "😟", "😕", "🙁", "☹️",
  "😣", "😖", "😫", "😩", "🥺", "😢", "😭", "😤", "😠", "😡",
  "🤬", "🤯", "😳", "🥵", "🥶", "😱", "😨", "😰", "😥", "😓",
  "🤗", "🤔", "🤭", "🤫", "🤥", "😶",
  "😐", "😑", "😬", "😮‍💨", "😮", "😯", "😲", "🥱",
  "😴", "🤤", "😪", "😵", "😵‍💫", "🤐", "🥴", "🤢", "🤮",
  "🤧", "😷", "🤒", "🤕", "🤑", "🤠", "😈", "👿", "👹", "👺",
  "💀", "☠️", "👻", "👽", "👾", "🤖", "🎃", "😺", "😸", "😹",
  "😻", "😼", "😽", "🙀", "😿", "😾", "🙈", "🙉", "🙊", "💋",
  "💌", "💘", "💝", "💖", "💗", "💓", "💞", "💕", "💟", "❣️",
  "💔", "❤️", "🧡", "💛", "💚", "💙", "💜", "🤎", "🖤", "🤍",
  "💯", "💢", "💥", "💫", "💦", "💨", "🕳️", "💣", "💬", "👁️‍🗨️",
  "🗨️", "🗯️", "💭", "👊", "✊", "🤛", "🤜", "👏", "🙌",  "👐", "🤲", "🤝", "🙏", "✍️", "💅", "🤳", "💪", "🦾", "🦿",
  "🦵", "🦶", "👂", "🦻", "👃", "🧠", "🦷", "🦴",
  "👀", "👁️", "👅", "👄", "👶", "🧒", "👦", "👧", "🧑",
  "👱", "👨", "🧔", "👨‍🦰", "👨‍🦱", "👨‍🦳", "👨‍🦲", "👩", "👩‍🦰", "👩‍🦱",
  "👩‍🦳", "👩‍🦲", "🧓", "👴", "👵", "🙍", "🙍‍♂️", "🙍‍♀️", "🙎", "🙎‍♂️",
  "🙎‍♀️", "🙅", "🙅‍♂️", "🙅‍♀️", "🙆", "🙆‍♂️", "🙆‍♀️", "💁", "💁‍♂️", "💁‍♀️",
  "🙋", "🙋‍♂️", "🙋‍♀️", "🧏", "🧏‍♂️", "🧏‍♀️", "🙇", "🙇‍♂️", "🙇‍♀️", "🤦",
  "🤦‍♂️", "🤦‍♀️", "🤷", "🤷‍♂️", "🤷‍♀️", "🧑‍⚕️", "👨‍⚕️", "👩‍⚕️", "🧑‍🎓", "👨‍🎓",
  "👩‍🎓", "🧑‍🏫", "👨‍🏫", "👩‍🏫", "🧑‍⚖️", "👨‍⚖️", "👩‍⚖️", "🧑‍🌾", "👨‍🌾", "👩‍🌾",
  "🧑‍🍳", "👨‍🍳", "👩‍🍳", "🧑‍🔧", "👨‍🔧", "👩‍🔧", "🧑‍🏭", "👨‍🏭", "👩‍🏭", "🧑‍💼",
  "👨‍💼", "👩‍💼", "🧑‍🔬", "👨‍🔬", "👩‍🔬", "🧑‍💻", "👨‍💻", "👩‍💻", "🧑‍🎤", "👨‍🎤",
  "👩‍🎤", "🧑‍🎨", "👨‍🎨", "👩‍🎨", "🧑‍✈️", "👨‍✈️", "👩‍✈️", "🧑‍🚀", "👨‍🚀", "👩‍🚀",
  "🧑‍🚒", "👨‍🚒", "👩‍🚒", "👮", "👮‍♂️", "👮‍♀️", "🕵️", "🕵️‍♂️", "🕵️‍♀️", "💂",
  "💂‍♂️", "💂‍♀️", "🥷", "👷", "👷‍♂️", "👷‍♀️", "🤴", "👸", "👳",
  "👳‍♂️", "👳‍♀️", "👲", "🧕", "🤵", "🤵‍♂️", "🤵‍♀️", "👰", "👰‍♂️", "👰‍♀️",
  "🤰", "🫄", "🫃", "🤱", "👩‍🍼", "👨‍🍼", "🧑‍🍼", "👼", "🎅", "🤶",
  "🧑‍🎄", "🦸", "🦸‍♂️", "🦸‍♀️", "🦹", "🦹‍♂️", "🦹‍♀️", "🧙", "🧙‍♂️", "🧙‍♀️",   "🧚", "🧚‍♂️", "🧚‍♀️", "🧛", "🧛‍♂️", "🧛‍♀️", "🧜", "🧜‍♂️", "🧜‍♀️", "🧝",
  "🧝‍♂️", "🧝‍♀️", "🧞", "🧞‍♂️", "🧞‍♀️", "🧟", "🧟‍♂️", "🧟‍♀️", "💆",
  "💆‍♂️", "💆‍♀️", "💇", "💇‍♂️", "💇‍♀️", "🚶", "🚶‍♂️", "🚶‍♀️", "🧍", "🧍‍♂️",
  "🧍‍♀️", "🧎", "🧎‍♂️", "🧎‍♀️", "🧑‍🦯", "👨‍🦯", "👩‍🦯", "🧑‍🦼", "👨‍🦼", "👩‍🦼",
  "🧑‍🦽", "👨‍🦽", "👩‍🦽", "🏃", "🏃‍♂️", "🏃‍♀️", "💃", "🕺", "🕴️", "👯",
  "👯‍♂️", "👯‍♀️", "🧖", "🧖‍♂️", "🧖‍♀️", "🧘", "🧑‍🤝‍🧑", "👭", "👫", "👬",
  "💏", "👩‍❤️‍💋‍👨", "👨‍❤️‍💋‍👨", "👩‍❤️‍💋‍👩", "💑", "👩‍❤️‍👨", "👨‍❤️‍👨", "👩‍❤️‍👩", "👪", "👨‍👩‍👦",
  "👨‍👩‍👧", "👨‍👩‍👧‍👦", "👨‍👩‍👦‍👦", "👨‍👩‍👧‍👧", "👩‍👩‍👦", "👩‍👩‍👧", "👩‍👩‍👧‍👦", "👩‍👩‍👦‍👦", "👩‍👩‍👧‍👧", "👨‍👨‍👦",
  "👨‍👨‍👧", "👨‍👨‍👧‍👦", "👨‍👨‍👦‍👦", "👨‍👨‍👧‍👧", "🗣️", "👤", "👥", "👣", "🧳",
  "🌂", "☂️", "🧵", "🧶", "👓", "🕶️", "🥽", "🥼",
  "🦺", "👔", "👕", "👖", "🧣", "🧤", "🧥", "🧦", "👗", "👘",
  "🥻", "🩱", "🩲", "🩳", "👙", "👚", "👛", "👜", "👝", "🛍️",
  "🎒", "👞", "👟", "🥾", "🥿", "👠", "👡", "🩰", "👢",
  "👑", "👒", "🎩", "🎓", "🧢", "⛑️", "📿", "💄", "💍",
  "💼", "🌂", "🥽", "🕶️", "👓", "🥿", "👢", "🩰", "👠",   "🧳", "💼", "💳", "💰", "💎", "⚖️", "🔧", "🔨",
  "⚒️", "🛠️", "⛏️", "🪓", "🔩", "⚙️", "🗜️", "⚗️", "🧪", "🧫",
  "🧬", "🔬", "🔭", "📡", "💉", "🩸", "💊", "🩹", "🩺", "🚪",
  "🛏️", "🛋️", "🪑", "🚽", "🚿", "🛁",, "🧴", "🧷",
  "🧹", "🧺", "🧻", "🪒", "🧼", "🧽", "🛎️",
  "🔑", "🗝️", "🚬", "⚰️", "⚱️", "🧿", "🕯️",
  "💡", "🔦", "🏮", "🪔", "📔", "📕", "📖", "📗", "📘", "📙",
  "📚", "📓", "📒", "📃", "📜", "📄", "📰", "🗞️", "📑", "🔖",
  "🏷️", "💰", "💳", "💴", "💵", "💶", "💷", "💸", "💹",
  "✉️", "📧", "📨", "📩", "📤", "📥", "📦", "📫", "📪", "📬",
  "📭", "📮", "🗳️", "✏️", "✒️", "🖋️", "🖊️", "🖌️", "🖍️", "📝",
  "💼", "📁", "📂", "🗂️", "📅", "📆", "🗒️", "🗓️", "📇", "📈",
  "📉", "📊", "📋", "📌", "📍", "📎", "🖇️", "📏", "📐", "✂️",
  "🗃️", "🗄️", "🗑️", "🔒", "🔓", "🔏", "🔐", "🔑", "🗝️", "🔨",   "🔧", "🔩", "⚙️", "🗜️", "⚖️", "🔬", "🔭", "📡", "💉", "🩺",
  "🌡️", "🧪", "🧫", "🧬", "🔮", "🧿", "🪬", "🕹️", "🎮", "🧩",
  "♟️", "🃏", "🀄", "🎴", "🎭", "🖼️", "🎨", "🧵", "🧶",
  "👓", "🕶️", "🥽", "🥼", "🦺", "👔", "👕", "👖", "🧣",
  "🧤", "🧥", "🧦", "👗", "👘", "🥻", "🩱", "🩲", "🩳", "👙",
  "👚", "👛", "👜", "👝", "🛍️", "🎒", "👞", "👟", "🥾",
  "🥿", "👠", "👡", "🩰", "👢", "👑", "👒", "🎩", "🎓", "🧢",
  "⛑️", "📿", "💄", "💍", "💼", "🌂", "☂️", "🧳",
  "💳", "💰", "💎", "🔧", "🔨", "⚒️", "🛠️", "⛏️", "🪓",
  "🔩", "⚙️", "🗜️", "⚗️", "🧪", "🧫", "🧬", "🔬", "🔭", "📡",
  "💉", "🩸", "💊", "🩹", "🩺", "🚪", "🛏️", "🛋️", "🪑", "🚽",
  "🚿", "🛁", "🧴", "🧷", "🧹", "🧺", "🧻",
  "🪒", "🧼", "🧽", "🛎️", "🔑", "🗝️", "🚬", "⚰️",
   "⚱️", "🧿", "🕯️", "💡", "🔦", "🏮", "🪔",   , "🧸", "🔋", "🔌", "💻",
  "🖥️", "🖨️", "⌨️", "🖱️", "🖲️", "💽", "💾", "💿", "📀", "🧮",
  "🎥", "🎞️", "📽️", "🎬", "📺", "📷", "📸", "📹", "📼", "🔍",
  "🔎", "🕯️", "💡", "🔦", "🏮", "🪔", "📔", "📕", "📖", "📗",
  "📘", "📙", "📚", "📓", "📒", "📃", "📜", "📄", "📰", "🗞️",
  "📑", "🔖", "🏷️", "💰", "💳", "💴", "💵", "💶", "💷",
  "💸", "💹", "✉️", "📧", "📨", "📩", "📤", "📥", "📦", "📫",
  "📪", "📬", "📭", "📮", "🗳️", "✏️", "✒️", "🖋️", "🖊️", "🖌️",
  "🖍️", "📝", "📁", "📂", "🗂️", "📅", "📆", "🗒️", "🗓️", "📇",
  "📈", "📉", "📊", "📋", "📌", "📍", "📎", "🖇️", "📏", "📐",
  "✂️", "🗃️", "🗄️", "🗑️", "🔒", "🔓", "🔏", "🔐", "🔑", "🗝️",
  "🌍", "🌎", "🌏", "🌐", "🗺️", "🧭", "🏔️", "⛰️", "🌋", "🗻",
  "🏕️", "🏖️", "🏜️", "🏝️", "🏞️", "🏟️", "🏛️", "🏗️", "🧱",
  "🏘️", "🏚️", "🏠", "🏡", "🏢", "🏣", "🏤", "🏥",
  "🏦", "🏨", "🏪", "🏫", "🏬", "🏯", "🏰", "💒", "🗼", "🗽"

];

    const cardIcons = [
      "fa-star", "fa-heart", "fa-moon", "fa-sun", "fa-cloud", "fa-rocket", "fa-dragon", "fa-crown", "fa-gem", "fa-bolt",
      "fa-fire", "fa-ghost", "fa-tree", "fa-feather", "fa-snowflake", "fa-anchor", "fa-hat-wizard", "fa-magic", "fa-bug", "fa-fish",
      "fa-dove", "fa-apple-alt", "fa-candy-cane", "fa-chess-knight", "fa-kiwi-bird", "fa-egg", "fa-leaf", "fa-star-of-life", "fa-paw", "fa-poop",
      "fa-bacterium", "fa-virus", "fa-biohazard", "fa-brain", "fa-skull-crossbones", "fa-spider", "fa-mask", "fa-eye", "fa-glasses", "fa-binoculars",
      "fa-camera-retro", "fa-video", "fa-microphone", "fa-guitar", "fa-headphones", "fa-music", "fa-gamepad", "fa-dice-d20", "fa-puzzle-piece", "fa-brush",
      "fa-pen-nib", "fa-highlighter", "fa-paint-roller", "fa-fill-drip", "fa-tools", "fa-screwdriver", "fa-wrench", "fa-cogs", "fa-microchip", "fa-battery-full",
      "fa-plug", "fa-lightbulb", "fa-satellite-dish", "fa-earth", "fa-meteor", "fa-space-shuttle", "fa-satellite", "fa-user-astronaut", "fa-jedi", "fa-scroll",
      "fa-book", "fa-book-dead", "fa-spell-check", "fa-feather-alt", "fa-broom", "fa-sleigh", "fa-igloo", "fa-hand-spock", "fa-hamsa", "fa-star-half-alt",
      "fa-mitten", "fa-campground", "fa-water", "fa-seedling", "fa-mountain", "fa-torii-gate", "fa-cocktail", "fa-ice-cream", "fa-hamburger", "fa-hotdog",
      "fa-pizza-slice"
    ];


    const cardColors = [
      "#00ffe7", "#ff00c8", "#00ff55", "#ffdd00", "#00c3ff",
      "#ff4d4d", "#aaff00", "#ff8000", "#e600ff", "#66ffff",
      "#ff99cc", "#66ff66", "#cc00ff", "#00ccff", "#ffcc00",
      "#ff0066", "#00ffcc", "#33cc33", "#ff3300", "#0099ff"
    ];




    const englishQuestions = [
    {
      "word": "egg",
      "translation": "ביצה"
    },
    {
      "word": "bed",
      "translation": "מיטה"
    },
    {
      "word": "bad",
      "translation": "רע"
    },
    {
      "word": "bag",
      "translation": "תיק"
    },
    {
      "word": "dad",
      "translation": "אבא"
    },
    {
      "word": "beg",
      "translation": "להתחנן"
    },
    {
      "word": "banana",
      "translation": "בננה"
    },
    {
      "word": "Dan",
      "translation": "דן"
    },
    {
      "word": "Ann",
      "translation": "אן"
    },
    {
      "word": "and",
      "translation": "ו"
    },
    {
      "word": "ten",
      "translation": "10"
    },
    {
      "word": "big",
      "translation": "גדול"
    },
    {
      "word": "pen",
      "translation": "עט"
    },
    {
      "word": "panda",
      "translation": "פנדה"
    },
    {
      "word": "look",
      "translation": "להסתכל"
    },
    {
      "word": "i am",
      "translation": "אני"
    },
    {
      "word": "i have",
      "translation": "יש לי"
    }
  ];

    


    const mathQuestions = [];
    for (let i = 1; i <= 10; i++) {
      for (let j = 1; j <= 10; j++) {
        mathQuestions.push({ word: `${i}×${j}`, translation: `${i * j}` });
      }
    }

    let currentMode = ""; // "english" or "math"


    let emojiBox = [];

    // משתנים
    let questions = [];
    let correctAnswer = "";
    let openQuestion = true;
    let correctStreak = 0;


    const slotSymbols = ['⭐', '🌟', '🍀', '🍒', '🍎', '🚀', '💎', '💰', '🎲', '🎯', '🧲'];
    let spinCounter = 0;
    let slotFailCount = 0;
    let currentWinThreshold = Math.floor(Math.random() * 3) + 1; // בין 1 ל־3


    const correctMessages = ["מעולה!", "נפלא!", "מצוין!", "מדהים!", "נהדר!", "כל הכבוד!", "פגז!", "איזה ביצוע!", "יוצא מן הכלל!", "תשובה מושלמת!"];
    const incorrectMessages = ["אופס!", "כמעט!", "לא לוותר!", "נסה שוב!", "סומך עלייך!", "לא בדיוק...", "עוד נסיון!", "ריכוז...", "המשך לנסות!", "קדימה!"];


    const game = new GameState();
    let isReversed = false;

    let wordEditorUnlocked = false;


    let lastEffect = -1;
    function changeBodyBackground() {


  // הסרת אפקט קודם אם קיים
  document.querySelectorAll(".bg-effect-layer").forEach(el => el.remove());

  const effects = [
    "glowBubbles",
    "twinklingStars",
    "lightTrail",
    "softFireworks",
    "colorDots",
    "floatingFlames",
    "gentleRain",
    "neonLasers",
    "rotatingAura",
    "hexGridPulse",
    "twistSwirl",
    "galaxySpiral"
  ];


  // מניעת חזרה על אותו אפקט
  let index;
  do {
    index = Math.floor(Math.random() * effects.length);
  } while (index === lastEffect);
  lastEffect = index;

  const effect = effects[index];
  const layer = document.createElement("div");
  layer.className = "bg-effect-layer";

  switch (effect) {
    case "glowBubbles":
      for (let i = 0; i < 20; i++) {
        const b = document.createElement("div");
        b.style.position = "absolute";
        b.style.left = Math.random() * 100 + "vw";
        b.style.bottom = "-50px";
        b.style.width = b.style.height = Math.random() * 20 + 10 + "px";
        b.style.borderRadius = "50%";
        b.style.background = "#00ffe7aa";
        b.style.animation = `floatBubbles ${4 + Math.random() * 6}s infinite ease-in`;
        b.style.animationDelay = Math.random() * 5 + "s";
        layer.appendChild(b);
      }
      break;

    case "twinklingStars":
      for (let i = 0; i < 50; i++) {
        const s = document.createElement("div");
        s.style.position = "absolute";
        s.style.left = Math.random() * 100 + "vw";
        s.style.top = Math.random() * 100 + "vh";
        s.style.width = s.style.height = Math.random() * 3 + 1 + "px";
        s.style.borderRadius = "50%";
        s.style.background = "#ffffff88";
        s.style.animation = `starsTwinkle ${2 + Math.random() * 3}s infinite ease-in-out`;
        s.style.animationDelay = Math.random() * 5 + "s";
        layer.appendChild(s);
      }
      break;

    case "lightTrail":
      const beam = document.createElement("div");
      beam.style.position = "absolute";
      beam.style.top = "40%";
      beam.style.left = "-100px";
      beam.style.width = "200px";
      beam.style.height = "4px";
      beam.style.background = "linear-gradient(90deg, transparent, #00ffe7aa, transparent)";
      beam.style.animation = "lightTrail 6s infinite ease-in-out";
      layer.appendChild(beam);
      break;

    case "softFireworks":
      for (let i = 0; i < 8; i++) {
        const fw = document.createElement("div");
        fw.style.position = "absolute";
        fw.style.left = Math.random() * 100 + "vw";
        fw.style.top = Math.random() * 100 + "vh";
        fw.style.width = fw.style.height = "20px";
        fw.style.borderRadius = "50%";
        fw.style.background = "radial-gradient(circle, #ff00ff, transparent)";
        fw.style.animation = `softFirework ${2 + Math.random()}s infinite ease-in-out`;
        fw.style.animationDelay = Math.random() * 5 + "s";
        layer.appendChild(fw);
      }
      break;

    case "colorDots":
      for (let i = 0; i < 40; i++) {
        const d = document.createElement("div");
        d.style.position = "absolute";
        d.style.left = Math.random() * 100 + "vw";
        d.style.top = Math.random() * 100 + "vh";
        d.style.width = d.style.height = Math.random() * 8 + 4 + "px";
        d.style.borderRadius = "50%";
        d.style.background = `hsl(${Math.random() * 360}, 100%, 70%)`;
        d.style.opacity = "0.6";
        d.style.animation = `colorDotsPulse ${2 + Math.random()}s infinite ease-in-out`;
        d.style.animationDelay = Math.random() * 3 + "s";
        layer.appendChild(d);
      }
      break;

      
      case "floatingFlames":
        for (let i = 0; i < 25; i++) {
          const f = document.createElement("div");
          f.style.position = "absolute";
          f.style.left = Math.random() * 100 + "vw";
          f.style.bottom = "-20px";
          f.style.width = f.style.height = Math.random() * 6 + 4 + "px";
          f.style.borderRadius = "50%";
          f.style.background = "radial-gradient(circle, #ff6600, transparent)";
          f.style.opacity = "0.7";
          f.style.animation = `floatFlames ${3 + Math.random() * 4}s infinite ease-in-out`;
          f.style.animationDelay = Math.random() * 5 + "s";
          layer.appendChild(f);
        }
        break;

      case "gentleRain":
        for (let i = 0; i < 60; i++) {
          const drop = document.createElement("div");
          drop.style.position = "absolute";
          drop.style.left = Math.random() * 100 + "vw";
          drop.style.top = Math.random() * -100 + "px";
          drop.style.width = "1px";
          drop.style.height = Math.random() * 20 + 10 + "px";
          drop.style.background = "#00ffe7aa";
          drop.style.opacity = "0.3";
          drop.style.animation = `rainFall ${2 + Math.random()}s infinite linear`;
          drop.style.animationDelay = Math.random() * 3 + "s";
          layer.appendChild(drop);
        }
        break;

      case "neonLasers":
        for (let i = 0; i < 6; i++) {
          const laser = document.createElement("div");
          laser.style.position = "absolute";
          laser.style.top = `${Math.random() * 100}vh`;
          laser.style.left = "-300px";
          laser.style.width = "300px";
          laser.style.height = "2px";
          laser.style.background = "linear-gradient(90deg, transparent, #ff00ffcc, transparent)";
          laser.style.animation = `laserSweep ${3 + Math.random()}s infinite ease-in-out`;
          laser.style.animationDelay = Math.random() * 2 + "s";
          layer.appendChild(laser);
        }
        break;
      
        case "rotatingAura":
          for (let i = 0; i < 6; i++) {
            const aura = document.createElement("div");
            aura.style.position = "absolute";
            aura.style.left = Math.random() * 100 + "vw";
            aura.style.top = Math.random() * 100 + "vh";
            aura.style.width = "80px";
            aura.style.height = "80px";
            aura.style.borderRadius = "50%";
            aura.style.background = "radial-gradient(circle, #ff00ff33, transparent)";
            aura.style.animation = `auraSpin ${3 + Math.random() * 2}s infinite ease-in-out`;
            aura.style.animationDelay = Math.random() * 3 + "s";
            layer.appendChild(aura);
          }
          break;
        
          case "hexGridPulse":
            for (let i = 0; i < 15; i++) {
              const hex = document.createElement("div");
              hex.style.position = "absolute";
              hex.style.left = Math.random() * 100 + "vw";
              hex.style.top = Math.random() * 100 + "vh";
              hex.style.width = "60px";
              hex.style.height = "60px";
              hex.style.border = "1px solid #00ffe7aa";
              hex.style.borderRadius = "10%";
              hex.style.animation = `hexPulse ${2 + Math.random()}s infinite ease-in-out`;
              layer.appendChild(hex);
            }
            break;
          
            case "twistSwirl":
              for (let i = 0; i < 10; i++) {
                const swirl = document.createElement("div");
                swirl.style.position = "absolute";
                swirl.style.left = Math.random() * 100 + "vw";
                swirl.style.top = Math.random() * 100 + "vh";
                swirl.style.width = "20px";
                swirl.style.height = "20px";
                swirl.style.borderRadius = "50%";
                swirl.style.background = "#9f3cfa88";
                swirl.style.animation = `twistSwirl ${3 + Math.random() * 2}s infinite ease-in-out`;
                swirl.style.animationDelay = Math.random() * 2 + "s";
                layer.appendChild(swirl);
              }
              break;
              
                case "galaxySpiral":
                  for (let i = 0; i < 12; i++) {
                    const dot = document.createElement("div");
                    dot.style.position = "absolute";
                    dot.style.left = "50vw";
                    dot.style.top = "50vh";
                    dot.style.width = "8px";
                    dot.style.height = "8px";
                    dot.style.borderRadius = "50%";
                    dot.style.background = "#00ffe7";
                    dot.style.animation = `galaxySpiral ${4 + Math.random() * 2}s infinite ease-in-out`;
                    dot.style.animationDelay = Math.random() * 2 + "s";
                    layer.appendChild(dot);
                  }
                  break;

        }
        

      document.body.appendChild(layer);

    }



    let lastScore = 0;

    function animateProgressBar(score) {
      const bar = document.getElementById("progress-bar");
      if (!bar) return;

      // אפקט מילוי רגיל
      bar.classList.add("increase");
      setTimeout(() => bar.classList.remove("increase"), 600);

      // חלקיקי אנרגיה עולים
      for (let i = 0; i < 6; i++) {
        const p = document.createElement("div");
        p.className = "energy-particle";
        p.textContent = ["⚡", "✨", "🔥"][Math.floor(Math.random() * 3)];
        p.style.left = `${Math.random() * 100}%`;
        bar.appendChild(p);
        setTimeout(() => p.remove(), 1300);
      }

      // כשהגענו למילוי שלם (10, 20, 30...)
      if (score % 10 === 0 && score !== lastScore) {
        lastScore = score;

        bar.classList.add("burst");
        bar.style.background = "linear-gradient(90deg, gold, white)";

        // פיצוץ ניצוצות
        for (let i = 0; i < 10; i++) {
          const spark = document.createElement("div");
          spark.className = "spark";
          spark.textContent = "✨";
          spark.style.left = "50%";
          spark.style.top = "0%";

          // כיוון אקראי
          const dx = Math.random();
          const dy = Math.random();
          spark.style.setProperty("--dx", dx);
          spark.style.setProperty("--dy", dy);

          bar.appendChild(spark);
          setTimeout(() => spark.remove(), 2000);
        }

        setTimeout(() => {
          bar.classList.remove("burst");
          bar.style.background = "";
        }, 2000);
      }
    }



    const localKey = "dynamicWords";

    function toggleWordEditor() {
      const panel = document.getElementById("wordEditor");
      const button = document.querySelector(".word-editor-toggle");

      if (panel.style.display === "flex") {
        panel.style.display = "none";
        // תמיד ייעלם כשהסוגרים
        button.style.display = "none";
      } else {
        panel.style.display = "flex";
        renderWordList();
      }
    }




    function renderWordList() {
      const listDiv = document.getElementById("wordList");
      listDiv.innerHTML = "";
      const stored = localStorage.getItem(localKey);
      const words = stored ? JSON.parse(stored) : [];

      words.forEach((entry, index) => {
        const div = document.createElement("div");
        div.className = "word-list-entry";
        div.innerHTML = `
          <span>${entry.word} ➜ ${entry.translation}</span>
          <button onclick="removeWord(${index})">מחק</button>
        `;
        listDiv.appendChild(div);
      });
    }

    function addNewWord() {
      const word = document.getElementById("newWordInput").value.trim();
      const translation = document.getElementById("newTranslationInput").value.trim();

      if (!word || !translation) {
        alert("יש למלא גם מילה וגם תרגום.");
        return;
      }

      const newEntry = { word, translation };
      let userWords = JSON.parse(localStorage.getItem("dynamicWords") || "[]");
      userWords.push(newEntry);
      localStorage.setItem("dynamicWords", JSON.stringify(userWords));


      document.getElementById("newWordInput").value = "";
      document.getElementById("newTranslationInput").value = "";

      renderWordList();
    }


    function removeWord(index) {
      const stored = localStorage.getItem(localKey);
      const words = stored ? JSON.parse(stored) : [];
      words.splice(index, 1);
      localStorage.setItem(localKey, JSON.stringify(words));
      renderWordList();
    }


    function getCombinedEnglishWords() {
      const base = [...englishQuestions];
      const stored = localStorage.getItem("dynamicWords");
      if (stored) {
        try {
          const custom = JSON.parse(stored);
          if (Array.isArray(custom)) {
            base.push(...custom);
          }
        } catch (e) {
          console.warn("שגיאה בקריאת dynamicWords:", e);
        }
      }
      return base;
    }









    function shouldWinSlot() {
      if (Math.random() < 0.15) {
        // זכייה מקרית מדי פעם (15%) בלי קשר לספירה
        slotFailCount = 0;
        currentWinThreshold = Math.floor(Math.random() * 3) + 1;
        return true;
      }

      slotFailCount++;

      if (slotFailCount >= currentWinThreshold) {
        slotFailCount = 0;
        currentWinThreshold = Math.floor(Math.random() * 4) + 3;  // כלומר רף בין 3 ל-6
        return true;
      }

      return false;
    }







    function showFloatingMessage(text, bg = "#00ffe7") {
      const msg = document.createElement("div");
      msg.textContent = text;
      msg.style.position = "fixed";
      msg.style.top = "50%";
      msg.style.left = "50%";
      msg.style.transform = "translate(-50%, -50%)";
      msg.style.background = bg;
      msg.style.color = "#000";
      msg.style.padding = "12px 20px";
      msg.style.fontSize = "1.2em";
      msg.style.borderRadius = "12px";
      msg.style.boxShadow = `0 0 10px ${bg}, 0 0 25px ${bg}`;
      msg.style.zIndex = "9999";
      msg.style.opacity = "1";
      msg.style.transition = "opacity 0.5s ease, transform 0.5s ease";
      msg.style.maxWidth = "80vw";
      msg.style.textAlign = "center";
      msg.style.wordWrap = "break-word";

      document.body.appendChild(msg);

      // תנועה קלה למעלה תוך כדי דעיכה
      setTimeout(() => {
        msg.style.opacity = "0";
        msg.style.transform = "translate(-50%, -60%)";
        setTimeout(() => msg.remove(), 500);
      }, 2000);
    }

    function flyEmojiToTop(emoji) {
      // אם הסגנון לא נוסף עדיין – נוסיף אותו פעם אחת
      if (!document.getElementById("fly-emoji-style")) {
        const style = document.createElement("style");
        style.id = "fly-emoji-style";
        style.textContent = `
          .fly-emoji {
            position: fixed;
            left: 50%;
            top: 50%;
            font-size: 4em;
            transform: translate(-50%, -50%);
            animation: flyUp 2s ease-in-out forwards;
            z-index: 9999;
            pointer-events: none;
          }

          @keyframes flyUp {
            0% {
              opacity: 1;
              transform: translate(-50%, -50%) scale(1);
            }
            80% {
              opacity: 1;
              transform: translate(-50%, -200%) scale(1.5);
            }
            100% {
              opacity: 0;
              transform: translate(-50%, -300%) scale(0.1);
            }
          }
        `;
        document.head.appendChild(style);
      }

      // יצירת האימוג'י
      const el = document.createElement("div");
      el.className = "fly-emoji";
      el.textContent = emoji;
      document.body.appendChild(el);

      // הסרה מה-DOM אחרי סיום האנימציה
      setTimeout(() => el.remove(), 1000);
    }

    function showCrownEffect() {
      // אם כבר קיים – אל תיצור שוב
      if (document.getElementById("crown-popup")) return;

      // 🟨 1. צור תגית <style> עם האנימציה
      const style = document.createElement("style");
      style.textContent = `
        @keyframes popIn {
          0% { transform: scale(0.7); opacity: 0; }
          100% { transform: scale(1); opacity: 1; }
        }
        @keyframes crownShine {
          0% { transform: rotate(0deg); }
          100% { transform: rotate(360deg); }
        }
      `;
      document.head.appendChild(style);

      // 🟦 2. צור את ה־HTML של הכתר
      const overlay = document.createElement("div");
      overlay.id = "crown-popup";
      overlay.style.position = "fixed";
      overlay.style.inset = "0";
      overlay.style.background = "rgba(0,0,0,0.7)";
      overlay.style.display = "flex";
      overlay.style.alignItems = "center";
      overlay.style.justifyContent = "center";
      overlay.style.zIndex = "9999";

      const crownBox = document.createElement("div");
      crownBox.style.background = "#000";
      crownBox.style.border = "3px solid gold";
      crownBox.style.borderRadius = "20px";
      crownBox.style.padding = "40px";
      crownBox.style.boxShadow = "0 0 30px gold";
      crownBox.style.animation = "popIn 0.4s ease";

      const crown = document.createElement("div");
      crown.textContent = "👑";
      crown.style.fontSize = "10em";
      crown.style.animation = "crownShine 4s linear infinite";
      crown.style.textShadow = "0 0 40px gold, 0 0 60px #ffcc00";

      const message = document.createElement("div");
      message.textContent = "וואו! 3 תשובות נכונות ברצף! קיבלת 5 מטבעות בונוס!";
      message.style.fontSize = "2em";
      message.style.color = "white";
      message.style.marginTop = "20px";
      message.style.textAlign = "center";
      message.style.textShadow = "0 0 15px gold";

      crownBox.appendChild(crown);
      crownBox.appendChild(message);
      overlay.appendChild(crownBox);
      document.body.appendChild(overlay);

      // 🧹 הסרה אוטומטית אחרי 3 שניות
      setTimeout(() => {
        overlay.remove();
      }, 4000);
    }

    function launchFlyingCrowns(amount = 10) {
      for (let i = 0; i < amount; i++) {
        const crown = document.createElement("div");
        crown.textContent = "👑";
        crown.style.position = "fixed";
        crown.style.left = Math.random() * window.innerWidth + "px";
        crown.style.top = window.innerHeight + "px";
        crown.style.fontSize = "60px";
        crown.style.zIndex = 9999;
        crown.style.opacity = 1;
        crown.style.transition = "transform 2s ease-out, opacity 2s ease-out";
        document.body.appendChild(crown);

        // טריגר לאנימציה
        setTimeout(() => {
          crown.style.transform = `translateY(-${300 + Math.random() * 300}px) scale(${0.5 + Math.random()})`;
          crown.style.opacity = 0;
        }, 50);

        // ניקוי
        setTimeout(() => {
          crown.remove();
        }, 2000);
      }
    }

    function pulseBordersWithRandomColor() {
      const color = cardColors[Math.floor(Math.random() * cardColors.length)];

      const elementsToUpdate = [
        ".main-frame",
        ".hud-box",
        ".question-box",
        ".progress-bar-container",
        ".emoji-track",
        ".card-track"
      ];

      elementsToUpdate.forEach(selector => {
        document.querySelectorAll(selector).forEach(el => {
          el.style.borderColor = color;
          el.style.boxShadow = `0 0 10px ${color}`;
        });
      });
    }









    function updateScoreUI() {
      document.getElementById("score").textContent = game.score;
      document.getElementById("level").textContent = game.level;
      document.getElementById("coin-count").textContent = game.coins;
      animateProgressBar(score);
    }


    function getRandomSymbol() {
      return slotSymbols[Math.floor(Math.random() * slotSymbols.length)];
    }

    



    function showSlotPopup() {
      document.getElementById("slot-popup").style.display = "flex";
      document.getElementById("slot-message").textContent = "";
      document.getElementById("reel1").innerHTML = "💰";
      document.getElementById("reel2").innerHTML = "💰";
      document.getElementById("reel3").innerHTML = "💰";
      document.getElementById("spinBtn").style.display = "block";
    }


    function startSpin() {
      if (window.spinning) return;
      window.spinning = true;

      const btn = document.getElementById("spinBtn");
      const message = document.getElementById("slot-message");
      message.textContent = "";
      btn.disabled = true;
      btn.textContent = "סיבוב...";

      const reels = ['reel1', 'reel2', 'reel3'].map(id => document.getElementById(id));
      const symbols = ['⭐', '🌟', '🍀', '🍒', '🍎', '🚀'];
      document.getElementById("slot2").play();

      

      function getRandomSymbol() {
        return symbols[Math.floor(Math.random() * symbols.length)];
      }

      reels.forEach(reel => {
        reel.classList.add("spinning");
        reel.innerHTML = `<span>${getRandomSymbol()}</span>`;
      });

      const interval = setInterval(() => {
        reels.forEach(reel => {
          reel.innerHTML = `<span>${getRandomSymbol()}</span>`;
        });
      }, 100);

      setTimeout(() => {
        clearInterval(interval);

        let results;
        if (shouldWinSlot()) {
          const winSymbol = symbols[Math.floor(Math.random() * symbols.length)];
          results = [winSymbol, winSymbol, winSymbol];
          console.log("🎯 זכייה מאולצת! רף היה:", currentWinThreshold);
        } else {
          results = reels.map(() => getRandomSymbol());
          console.log("❌ לא זכית. כשלונות רצופים:", slotFailCount, " | רף זכייה:", currentWinThreshold);
        }

        reels.forEach((reel, i) => {
          reel.classList.remove("spinning");
          reel.innerHTML = `<span>${results[i]}</span>`;
        });

        if (results[0] === results[1] && results[1] === results[2]) {
          message.textContent = "✨ זכייה! קיבלת 10 מטבעות!";
          message.style.color = '#00ff00';
          game.addCoins(10);
          updateScoreUI();
        } else {
          message.textContent = "ננסה שוב בפעם הבאה!";
          message.style.color = '#ffffff';
        }

        btn.disabled = false;
        btn.textContent = "סובב";
        window.spinning = false;
        document.getElementById("spinBtn").style.display = "none";

        setTimeout(() => {
          document.getElementById("slot-popup").style.display = "none";
        }, 2500);
      }, 2500);
    }





    

    function showNextEmoji() {
      document.getElementById("emoji-preview").textContent = emojis[game.emojiIndex] || "";
    }



function loadEmojiBox() {
  const stored = localStorage.getItem("emojiBox");
  if (stored) {
    emojiBox = JSON.parse(stored);
    emojiIndex = emojiBox.length % emojis.length; // הגדר את אינדקס האימוג'י אחרי קריאה מהזיכרון
  } else {
    emojiBox = [];
    //emojiIndex = 0; // הגדר את האינדקס מההתחלה אם לא שמרת קודם
  }
}



    function openEmojiModal() {
      const modal = document.getElementById("emoji-modal");
      const content = document.getElementById("emoji-modal-content");

      content.innerHTML = game.emojiBox.length
        ? game.emojiBox.join(" ")
        : "לא זכית עדיין באף אימוג'י 😢";

      modal.style.display = "block";
    }


    function closeEmojiModal() {
      document.getElementById("emoji-modal").style.display = "none";
    }



    function openCardModal() {
      const modal = document.getElementById("card-modal");
      const content = document.getElementById("card-modal-content");

      let html = '<div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(80px, 1fr)); gap: 15px;">';

      cardIcons.forEach((icon, index) => {
        const owned = game.hasCard(icon);
        const price = (index + 1) * 10;
        const iconColor = owned ? (game.cardColors[icon] || "#00ffe7") : "#444";
        const disabled = owned ? "disabled" : "";

        html += `
          <div style="text-align:center;">
            <i class="fas ${icon}" style="font-size: 2em; color: ${iconColor};"></i>
            <div style="margin-top: 5px;">
              <button onclick="buySpecificCard(${index})" ${disabled}
                style="font-size: 0.7em; margin-top: 5px; padding: 5px 10px; border-radius: 8px; border: 2px solid #00ffe7; background: transparent; color: #00ffe7; cursor: pointer;">
                ${owned ? "נקנה" : price + " מטבעות"}
              </button>
            </div>
          </div>
        `;
      });

      html += '</div>';

      content.innerHTML = html;
      modal.style.display = "block";
    }


function closeCardModal() {
  document.getElementById("card-modal").style.display = "none";
}







function showMessage(msg) {
  const el = document.createElement("div");
  el.textContent = msg;
  el.style.position = "fixed";
  el.style.bottom = "100px";
  el.style.left = "50%";
  el.style.transform = "translateX(-50%)";
  el.style.background = "#00ffe7";
  el.style.color = "#000";
  el.style.padding = "10px 20px";
  el.style.borderRadius = "10px";
  el.style.fontSize = "1.2em";
  el.style.boxShadow = "0 0 10px #00ffe7";
  el.style.zIndex = "1000";
  el.style.transition = "opacity 0.5s";
  document.body.appendChild(el);
  setTimeout(() => {
    el.style.opacity = "0";
    setTimeout(() => el.remove(), 500);
  }, 2000);
}

function tryBuyCard() {
  const nextPrice = (game.cards.length + 1) * 10;
  const nextIcon = cardIcons[game.cards.length % cardIcons.length];

  if (game.spendCoins(nextPrice)) {
    game.addCard(nextIcon);
    updateScoreUI();
    showMessage("🎉 קנית קלף חדש!");
  } else {
    showMessage("❌ אין לך מספיק מטבעות.");
  }
}






function buySpecificCard(index) {
  const icon = cardIcons[index];
  const price = (index + 1) * 10;

  if (game.hasCard(icon)) return;

  if (game.spendCoins(price)) {
    game.addCard(icon);
    updateScoreUI();
    openCardModal(); // מרענן את התצוגה
    showMessage("🎉 קנית את הקלף!");
    document.getElementById("card1").play();
  } else {
    showMessage("❌ אין לך מספיק מטבעות.");
  }
}


function updateProgressBar() {
  const current = game.score % 10; // כמה נקודות מתוך 10
  const percent = (current / 10) * 100;
  document.getElementById("progress-inner").style.width = percent + "%";
}










    // פונקציית התחלה לאנגלית
    function startEnglishMode() {
      currentMode = "english";
      questions = getCombinedEnglishWords();
      loadEmojiBox();
      nextQuestion();
      showNextEmoji();
      updateScoreUI();
    }



    function startMathMode() {
      currentMode = "math";
      questions = [...mathQuestions];
      loadEmojiBox();
      nextQuestion();
      showNextEmoji();
      updateScoreUI();
    }



    // פונקציה שמציגה שאלה חדשה
    function nextQuestion() {
      const q = questions[Math.floor(Math.random() * questions.length)];
      if (!q) return showError("שאלה לא תקינה");

      let word, topic;

      if (currentMode === "english") {
        isReversed = Math.random() < 0.5;
        word = isReversed ? q.translation : q.word;
        correctAnswer = isReversed ? q.word : q.translation;
        topic = isReversed ? "מה המילה באנגלית ל" : "מה התרגום של";
      } else {
        // חשבון כרגיל
        word = q.word;
        correctAnswer = q.translation;
        topic = "מה התוצאה של";
      }

      openQuestion = Math.random() < 0.5;
      displayQuestion(word, topic);
      renderInputOrOptions();
      showNextEmoji();
    }


    // הצגת טקסט השאלה
    function displayQuestion(word) {
      const topic = word.includes("×") ? "מה התוצאה של" : "מה התרגום של";
      document.getElementById("question").innerHTML = `
        <div style="font-size: 0.8em; margin-bottom: 5px;">${topic}</div>
        <div style="font-size: 2.2em; font-weight: bold;">${word}</div>`;

      document.getElementById("feedback").textContent = "";
    }

    // מציג תשובות פתוחות או בחירה אמריקאית
    function renderInputOrOptions() {
      const answerInput = document.getElementById("answer");
      const submitBtn = document.getElementById("submit-btn");
      const optionsDiv = document.getElementById("options");

      answerInput.value = "";
      hideAll();

      if (openQuestion) {
        show(answerInput);
        show(submitBtn);
        document.getElementById("answer").value = "";
        document.getElementById("answer").focus();
        submitBtn.onclick = () => checkAnswer(answerInput.value.trim());
      } else {
        show(optionsDiv);
        const opts = shuffle([correctAnswer, ...getRandomAnswers(correctAnswer)]); // ✅ תיקון

        optionsDiv.innerHTML = "";
        opts.forEach(opt => {
          const btn = document.createElement("button");
          btn.textContent = opt;
          btn.onclick = () => checkAnswer(opt);
          optionsDiv.appendChild(btn);
        });
      }
    }

    

    // בדיקת תשובה
    function checkAnswer(answer) {
      const feedback = document.getElementById("feedback");

      // בדיקה אם הסיסמה הוזנה
      if (answer === "55555") {
        wordEditorUnlocked = true;
        document.querySelector(".word-editor-toggle").style.display = "inline-block";
        showMessage("🔓 מצב עריכת מילים נפתח!");
        document.getElementById("answer").value = "";
        return;
      }


      if (answer.toLowerCase() === correctAnswer.toLowerCase()) {
        feedback.textContent = "תשובה נכונה!";
        feedback.style.color = "lime";
        document.getElementById("yes1").play();
        updateProgressBar();

        const msg = correctMessages[Math.floor(Math.random() * correctMessages.length)];
        showFloatingMessage(msg, "#00ff90");

        const currentEmoji = emojis[game.emojiIndex];
        flyEmojiToTop(currentEmoji);
        pulseBordersWithRandomColor();
        changeBodyBackground();



        game.addEmoji(emojis[game.emojiIndex]);  // הוסף את האימוג'י לפי האינדקס השמור
        game.emojiIndex = (game.emojiIndex + 1) % emojis.length;  // עדכן את האינדקס
        game.save(); // שמור את המצב כדי שלא יאבד
        game.incrementScore();
        game.addCoins(1); // כל תשובה נכונה שווה מטבע
        correctStreak++;
        
        
        if (game.score % 5 === 0) {
          setTimeout(() => {
            showSlotPopup();
        }, 2000);
          
        }




        if (correctStreak === 3) {
          game.addCoins(5); // בונוס 5 מטבעות על רצף של 3 תשובות
          document.getElementById("slot1").play();
          correctStreak = 0;
          showCrownEffect();
          launchFlyingCrowns(15);
          //showMessage("🔥 בונוס! 3 תשובות רצופות = 5 מטבעות!");
        }

        updateScoreUI();
        showNextEmoji();
        setTimeout(nextQuestion, 1000);
      } else {
        feedback.textContent = "טעות. נסה שוב:";
        document.getElementById("no1").play();
        feedback.style.color = "red";
        const message = incorrectMessages[Math.floor(Math.random() * incorrectMessages.length)];
        showFloatingMessage(message, "#ff5555");
        correctStreak = 0;
        if (openQuestion) {
          document.getElementById("answer").value = "";
          document.getElementById("answer").focus();
        }
      }
    }



    // מחזיר 3 תשובות שגויות רנדומליות
    function getRandomAnswers(correctAnswer) {
      if (currentMode === "english") {
        const wrongs = englishQuestions
          .filter(q => {
            const val = isReversed ? q.word : q.translation;
            const question = isReversed ? q.translation : q.word;
            return val !== correctAnswer && val !== question;
          })
          .map(q => isReversed ? q.word : q.translation);

        return shuffle(wrongs).slice(0, 3);
      }

      // מתמטיקה
      const correct = parseInt(correctAnswer);
      const candidates = [];
      for (let i = correct - 5; i <= correct + 5; i++) {
        if (i > 0 && i !== correct) {
          candidates.push(i.toString());
        }
      }
      return shuffle(candidates).slice(0, 3);
    }






    
    
    
    
    
    
    
    
    
    // ערבוב מערך
    function shuffle(arr) {
      return arr.sort(() => Math.random() - 0.5);
    }

    
    
    
    
    
    
    
    // הסתרת כל האפשרויות
    function hideAll() {
      ["answer", "submit-btn", "options"].forEach(id => hide(document.getElementById(id)));
    }




    

    function hide(el) {
      el.classList.add("hidden");
      el.style.display = "none";
    }

    function show(el) {
      el.classList.remove("hidden");
      el.style.display = "block";
    }

    function showError(msg) {
      const questionBox = document.getElementById("question");
      questionBox.innerHTML = `<div style='color:red;'>❌ ${msg}</div>`;
      hideAll();
    }

    





    window.addEventListener("DOMContentLoaded", () => {
      hideAll();
      updateScoreUI();
      renderWordList();
      document.querySelector(".card-box-toggle").addEventListener("click", openCardModal);

      // ✅ הוספת התמיכה באנטר
      document.getElementById("answer").addEventListener("keydown", function(event) {
        if (event.key === "Enter") {
          event.preventDefault();
          document.getElementById("submit-btn").click();
        }
      });
    });


    document.getElementById("reveal-btn1").addEventListener("click", () => {
      const feedback = document.getElementById("feedback");
      feedback.textContent = "📣 התשובה הנכונה: " + correctAnswer;
      feedback.style.color = "yellow";
    });



    let deferredPrompt = null;

window.addEventListener('beforeinstallprompt', (e) => {
  e.preventDefault();
  deferredPrompt = e;
  document.getElementById('installBtn').style.display = 'block';
});

document.getElementById('installBtn').addEventListener('click', async () => {
  if (deferredPrompt) {
    deferredPrompt.prompt();
    const { outcome } = await deferredPrompt.userChoice;
    if (outcome === 'accepted') {
      console.log('User accepted install');
    } else {
      console.log('User dismissed install');
    }
    deferredPrompt = null;
    document.getElementById('installBtn').style.display = 'none';
  }
});







  </script>


</body>
</html>
